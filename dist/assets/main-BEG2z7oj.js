const L=document.getElementById("mobile-search-toggle"),b=document.getElementById("mobile-search"),P=document.getElementById("mobile-search-close"),T=document.getElementById("site-search-mobile"),k=document.getElementById("site-brand"),q=document.getElementById("mobile-actions"),h=document.getElementById("mobile-menu-toggle"),M=document.getElementById("mobile-menu");if(h&&M){const r=h.querySelector('[data-mobile-menu-icon="open"]'),t=h.querySelector('[data-mobile-menu-icon="close"]'),i=M.querySelector("#mobile-menu-backdrop"),e=n=>{M.classList.toggle("hidden",!n),h.setAttribute("aria-expanded",n?"true":"false"),document.body.classList.toggle("overflow-hidden",n),r&&t&&(r.classList.toggle("hidden",n),t.classList.toggle("hidden",!n))};e(!1),h.addEventListener("click",()=>{const n=h.getAttribute("aria-expanded")==="true";e(!n)}),i instanceof HTMLElement&&i.addEventListener("click",()=>{e(!1)}),window.addEventListener("keydown",n=>{n.key==="Escape"&&h.getAttribute("aria-expanded")==="true"&&e(!1)}),M.addEventListener("click",n=>{const s=n.target;s instanceof Element&&s.closest("a")&&e(!1)})}if(L&&b&&P&&T){const r=t=>{if(L.setAttribute("aria-expanded",t?"true":"false"),b.classList.toggle("pointer-events-none",!t),b.classList.toggle("opacity-0",!t),b.classList.toggle("opacity-100",t),b.classList.toggle("[transform:scaleX(0.92)]",!t),b.classList.toggle("[transform:scaleX(1)]",t),k&&(k.classList.toggle("pointer-events-none",t),k.classList.toggle("opacity-0",t)),q&&(q.classList.toggle("pointer-events-none",t),q.classList.toggle("opacity-0",t)),h&&M){M.classList.add("hidden"),h.setAttribute("aria-expanded","false"),document.body.classList.remove("overflow-hidden");const i=h.querySelector('[data-mobile-menu-icon="open"]'),e=h.querySelector('[data-mobile-menu-icon="close"]');i&&e&&(i.classList.remove("hidden"),e.classList.add("hidden"))}t?(T.focus(),T.select()):L.focus()};r(!1),L.addEventListener("click",()=>{const t=L.getAttribute("aria-expanded")==="true";r(!t)}),P.addEventListener("click",()=>{r(!1)}),window.addEventListener("keydown",t=>{t.key==="Escape"&&L.getAttribute("aria-expanded")==="true"&&r(!1)}),document.addEventListener("click",t=>{if(L.getAttribute("aria-expanded")!=="true")return;const i=t.target;i instanceof Node&&(b.contains(i)||L.contains(i)||r(!1))})}const c=document.getElementById("trend-bar");if(c){let r=window.scrollY,t=!1,i=!1,e=0,n=0,s=0,o=null;const d=()=>{o&&(c.removeEventListener("transitionend",o),o=null)},m=()=>{i&&(i=!1,c.classList.remove("pointer-events-none"),c.style.opacity="1",c.style.maxHeight=`${c.scrollHeight}px`,window.clearTimeout(s),d(),o=y=>{y instanceof TransitionEvent&&y.propertyName==="max-height"&&(i||(d(),c.style.maxHeight="none"))},c.addEventListener("transitionend",o),s=window.setTimeout(()=>{i||(d(),c.style.maxHeight="none")},600),e=0,n=performance.now())},x=()=>{i||(i=!0,window.clearTimeout(s),d(),(c.style.maxHeight==="none"||c.style.maxHeight==="")&&(c.style.maxHeight=`${c.scrollHeight}px`),c.offsetHeight,c.classList.add("pointer-events-none"),c.style.opacity="0",c.style.maxHeight="0px",e=0,n=performance.now())};c.style.opacity="1",c.style.maxHeight="none";const w=()=>{const y=window.scrollY,a=y-r;if(r=y,!(performance.now()-n<180)){if(y<20){m();return}if(!(Math.abs(a)<2)){if(a>0?e=Math.max(0,e)+a:e=Math.min(0,e)+a,e>30){x();return}e<-30&&m()}}};window.addEventListener("scroll",()=>{t||(t=!0,window.requestAnimationFrame(()=>{w(),t=!1}))},{passive:!0})}const v=document.querySelector(".js-featured-image"),O=document.querySelector(".js-featured-panel");if(v instanceof HTMLImageElement&&O instanceof HTMLElement){const r=e=>{const n=document.createElement("canvas"),s=n.getContext("2d",{willReadFrequently:!0});if(!s)return null;const o=48,d=48;n.width=o,n.height=d,s.drawImage(e,0,0,o,d);const{data:m}=s.getImageData(0,0,o,d);let x=0,w=0,y=0,a=0;for(let g=0;g<m.length;g+=4){if(m[g+3]<32)continue;const l=m[g],E=m[g+1],p=m[g+2],B=Math.max(l,E,p),U=Math.min(l,E,p),C=B===0?0:(B-U)/B;B>245&&C<.1||(x+=l,w+=E,y+=p,a+=1)}return a===0?null:{r:Math.round(x/a),g:Math.round(w/a),b:Math.round(y/a)}},t=(e,n=.82)=>{const s=1-n;return{r:Math.round(255*n+e.r*s),g:Math.round(255*n+e.g*s),b:Math.round(255*n+e.b*s)}},i=()=>{try{const e=v.currentSrc||v.src;typeof e=="string"&&e!==""&&O.style.setProperty("--featured-image",`url(${JSON.stringify(e)})`);const n=r(v);if(!n)return;const s=t(n);O.style.setProperty("--featured-panel-bg",`rgb(${s.r} ${s.g} ${s.b})`)}catch{return}};v.complete&&v.naturalWidth>0?i():v.addEventListener("load",i,{once:!0})}const u=document.getElementById("stories-list"),N=document.getElementById("stories-sentinel"),R=document.getElementById("stories-loading");if(u&&N){let r=!1,t=!1;const i=u instanceof HTMLElement?u.dataset.categoryId:void 0,e=u instanceof HTMLElement?u.dataset.searchQuery:void 0,n=u instanceof HTMLElement?u.dataset.tagId:void 0,s=u instanceof HTMLElement?Number.parseInt(u.dataset.nextOffset??"",10):Number.NaN;let o=Number.isFinite(s)?s:1+u.querySelectorAll("article").length;const d=a=>{R&&R.classList.toggle("hidden",!a)},m=async()=>{if(!(r||t)){r=!0,d(!0);try{const a=new URLSearchParams({offset:String(o),limit:"5"});typeof i=="string"&&i!==""&&a.set("category",i),typeof e=="string"&&e!==""&&a.set("search",e),typeof n=="string"&&n!==""&&a.set("tag",n);const g=`/wp-json/yahoonews/v1/stories?${a.toString()}`,A=await fetch(g,{headers:{Accept:"application/json"}});if(!A.ok){t=!0;return}const l=await A.json(),E=Array.isArray(l==null?void 0:l.items)?l.items:[];if(E.length===0){t=!0;return}for(const p of E)p!=null&&p.html&&u.insertAdjacentHTML("beforeend",p.html);o=typeof(l==null?void 0:l.nextOffset)=="number"?l.nextOffset:o+E.length,u instanceof HTMLElement&&(u.dataset.nextOffset=String(o)),(l==null?void 0:l.hasMore)===!1&&(t=!0)}finally{r=!1,d(!1)}}},x=()=>N.getBoundingClientRect().top<=window.innerHeight+600,w=async()=>{for(;!r&&!t&&x();)await m()};new IntersectionObserver(a=>{const g=a[0];!g||!g.isIntersecting||w()},{rootMargin:"600px 0px"}).observe(N),w()}const H=document.getElementById("read-action"),$=document.getElementById("read-action-progress"),W=document.getElementById("read-action-icon-close"),j=document.getElementById("read-action-icon-up"),f=document.getElementById("top-stories-scroll"),I=document.getElementById("top-stories-prev"),S=document.getElementById("top-stories-next");if(f instanceof HTMLElement&&I instanceof HTMLButtonElement&&S instanceof HTMLButtonElement){let r=!1;const t=()=>f.scrollLeft+f.clientWidth>=f.scrollWidth-8,i=()=>f.scrollLeft<=8,e=()=>f.scrollWidth>f.clientWidth+8,n=()=>{const o=e();I.classList.toggle("hidden",i()),I.disabled=!o,I.classList.toggle("opacity-30",!o),I.classList.toggle("cursor-not-allowed",!o),S.disabled=!o,S.classList.toggle("opacity-30",!o),S.classList.toggle("cursor-not-allowed",!o)},s=()=>{r||(r=!0,window.requestAnimationFrame(()=>{n(),r=!1}))};S.addEventListener("click",()=>{if(!e())return;if(t()){f.scrollTo({left:0,behavior:"smooth"});return}const o=Math.max(220,Math.round(f.clientWidth*.7));f.scrollBy({left:o,behavior:"smooth"})}),I.addEventListener("click",()=>{if(!e())return;const o=Math.max(220,Math.round(f.clientWidth*.7));f.scrollBy({left:-o,behavior:"smooth"})}),f.addEventListener("scroll",s,{passive:!0}),window.addEventListener("resize",s),n()}if(H instanceof HTMLButtonElement&&$ instanceof SVGPathElement){let r=!1,t=!1;const i=s=>{t=s,W instanceof SVGElement&&W.classList.toggle("hidden",s),j instanceof SVGElement&&j.classList.toggle("hidden",!s),H.setAttribute("aria-label",s?"Back to top":"Close")},e=()=>{const s=document.documentElement,o=window.scrollY||s.scrollTop||0,d=Math.max(1,s.scrollHeight-window.innerHeight),m=Math.max(0,Math.min(1,o/d));$.setAttribute("stroke-dasharray",`${m*100} 100`),i(o>160)},n=()=>{r||(r=!0,window.requestAnimationFrame(()=>{e(),r=!1}))};H.addEventListener("click",()=>{if(t){window.scrollTo({top:0,behavior:"smooth"});return}const s=H.dataset.homeUrl;if(typeof s=="string"&&s!==""){window.location.href=s;return}}),window.addEventListener("scroll",n,{passive:!0}),window.addEventListener("resize",n),e()}
