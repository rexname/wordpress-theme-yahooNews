const b=document.getElementById("mobile-search-toggle"),v=document.getElementById("mobile-search"),C=document.getElementById("mobile-search-close"),k=document.getElementById("site-search-mobile"),P=document.getElementById("site-brand"),q=document.getElementById("mobile-actions"),p=document.getElementById("mobile-menu-toggle"),S=document.getElementById("mobile-menu");if(p&&S){const a=p.querySelector('[data-mobile-menu-icon="open"]'),n=p.querySelector('[data-mobile-menu-icon="close"]'),s=S.querySelector("#mobile-menu-backdrop"),e=t=>{S.classList.toggle("hidden",!t),p.setAttribute("aria-expanded",t?"true":"false"),document.body.classList.toggle("overflow-hidden",t),a&&n&&(a.classList.toggle("hidden",t),n.classList.toggle("hidden",!t))};e(!1),p.addEventListener("click",()=>{const t=p.getAttribute("aria-expanded")==="true";e(!t)}),s instanceof HTMLElement&&s.addEventListener("click",()=>{e(!1)}),window.addEventListener("keydown",t=>{t.key==="Escape"&&p.getAttribute("aria-expanded")==="true"&&e(!1)}),S.addEventListener("click",t=>{const o=t.target;o instanceof Element&&o.closest("a")&&e(!1)})}if(b&&v&&C&&k){const a=n=>{if(b.setAttribute("aria-expanded",n?"true":"false"),v.classList.toggle("pointer-events-none",!n),v.classList.toggle("opacity-0",!n),v.classList.toggle("opacity-100",n),v.classList.toggle("[transform:scaleX(0.92)]",!n),v.classList.toggle("[transform:scaleX(1)]",n),P&&(P.classList.toggle("pointer-events-none",n),P.classList.toggle("opacity-0",n)),q&&(q.classList.toggle("pointer-events-none",n),q.classList.toggle("opacity-0",n)),p&&S){S.classList.add("hidden"),p.setAttribute("aria-expanded","false"),document.body.classList.remove("overflow-hidden");const s=p.querySelector('[data-mobile-menu-icon="open"]'),e=p.querySelector('[data-mobile-menu-icon="close"]');s&&e&&(s.classList.remove("hidden"),e.classList.add("hidden"))}n?(k.focus(),k.select()):b.focus()};a(!1),b.addEventListener("click",()=>{const n=b.getAttribute("aria-expanded")==="true";a(!n)}),C.addEventListener("click",()=>{a(!1)}),window.addEventListener("keydown",n=>{n.key==="Escape"&&b.getAttribute("aria-expanded")==="true"&&a(!1)}),document.addEventListener("click",n=>{if(b.getAttribute("aria-expanded")!=="true")return;const s=n.target;s instanceof Node&&(v.contains(s)||b.contains(s)||a(!1))})}const i=document.getElementById("trend-bar");if(i){let a=window.scrollY,n=!1,s=!1,e=0,t=0,o=0,r=null,h=null;const u=window.matchMedia("(min-width: 768px)"),I=()=>u.matches?{toggleCooldownMs:200,topLockPx:80,minDeltaPx:4,hideThresholdPx:160,showThresholdPx:-70}:{toggleCooldownMs:180,topLockPx:20,minDeltaPx:2,hideThresholdPx:30,showThresholdPx:-30},y=()=>{r&&(i.removeEventListener("transitionend",r),r=null)},T=()=>{h||typeof ResizeObserver=="function"&&(h=new ResizeObserver(()=>{if(s)return;const c=i.style.maxHeight;c==="none"||c===""||(i.style.maxHeight=`${i.scrollHeight}px`)}),h.observe(i))},l=()=>{s&&(T(),s=!1,i.classList.remove("pointer-events-none"),i.style.opacity="1",i.style.maxHeight=`${i.scrollHeight}px`,window.clearTimeout(o),y(),r=c=>{c instanceof TransitionEvent&&c.propertyName==="max-height"&&(s||(y(),i.style.maxHeight="none"))},i.addEventListener("transitionend",r),o=window.setTimeout(()=>{s||(y(),i.style.maxHeight="none")},600),window.requestAnimationFrame(()=>{if(s)return;const c=i.style.maxHeight;c==="none"||c===""||(i.style.maxHeight=`${i.scrollHeight}px`)}),e=0,t=performance.now())},f=()=>{s||(s=!0,window.clearTimeout(o),y(),(i.style.maxHeight==="none"||i.style.maxHeight==="")&&(i.style.maxHeight=`${i.scrollHeight}px`),i.offsetHeight,i.classList.add("pointer-events-none"),i.style.opacity="0",i.style.maxHeight="0px",e=0,t=performance.now())};i.style.opacity="1",i.style.maxHeight="none";const E=()=>{s=!1,window.clearTimeout(o),y(),i.classList.remove("pointer-events-none"),i.style.opacity="1",i.style.maxHeight="none",e=0,t=performance.now()},d=()=>{const c=window.scrollY,L=c-a;a=c;const x=I();if(!(performance.now()-t<x.toggleCooldownMs)){if(c<x.topLockPx){l();return}if(!(Math.abs(L)<x.minDeltaPx)){if(L>0?e=Math.max(0,e)+L:e=Math.min(0,e)+L,e>x.hideThresholdPx){f();return}e<x.showThresholdPx&&l()}}},w=()=>{n||(n=!0,window.requestAnimationFrame(()=>{d(),n=!1}))};E(),window.addEventListener("scroll",w,{passive:!0}),typeof u.addEventListener=="function"?u.addEventListener("change",E):typeof u.addListener=="function"&&u.addListener(E)}const M=document.querySelector(".js-featured-image"),O=document.querySelector(".js-featured-panel");if(M instanceof HTMLImageElement&&O instanceof HTMLElement){const a=e=>{const t=document.createElement("canvas"),o=t.getContext("2d",{willReadFrequently:!0});if(!o)return null;const r=48,h=48;t.width=r,t.height=h,o.drawImage(e,0,0,r,h);const{data:u}=o.getImageData(0,0,r,h);let I=0,y=0,T=0,l=0;for(let f=0;f<u.length;f+=4){if(u[f+3]<32)continue;const d=u[f],w=u[f+1],c=u[f+2],L=Math.max(d,w,c),x=Math.min(d,w,c),$=L===0?0:(L-x)/L;L>245&&$<.1||(I+=d,y+=w,T+=c,l+=1)}return l===0?null:{r:Math.round(I/l),g:Math.round(y/l),b:Math.round(T/l)}},n=(e,t=.82)=>{const o=1-t;return{r:Math.round(255*t+e.r*o),g:Math.round(255*t+e.g*o),b:Math.round(255*t+e.b*o)}},s=()=>{try{const e=M.currentSrc||M.src;typeof e=="string"&&e!==""&&O.style.setProperty("--featured-image",`url(${JSON.stringify(e)})`);const t=a(M);if(!t)return;const o=n(t);O.style.setProperty("--featured-panel-bg",`rgb(${o.r} ${o.g} ${o.b})`)}catch{return}};M.complete&&M.naturalWidth>0?s():M.addEventListener("load",s,{once:!0})}const m=document.getElementById("stories-list"),R=document.getElementById("stories-sentinel"),N=document.getElementById("stories-loading");if(m&&R){let a=!1,n=!1;const s=m instanceof HTMLElement?m.dataset.categoryId:void 0,e=m instanceof HTMLElement?m.dataset.searchQuery:void 0,t=m instanceof HTMLElement?m.dataset.tagId:void 0,o=m instanceof HTMLElement?Number.parseInt(m.dataset.nextOffset??"",10):Number.NaN;let r=Number.isFinite(o)?o:1+m.querySelectorAll("article").length;const h=l=>{N&&N.classList.toggle("hidden",!l)},u=async()=>{if(!(a||n)){a=!0,h(!0);try{const l=new URLSearchParams({offset:String(r),limit:"5"});typeof s=="string"&&s!==""&&l.set("category",s),typeof e=="string"&&e!==""&&l.set("search",e),typeof t=="string"&&t!==""&&l.set("tag",t);const f=`/wp-json/yahoonews/v1/stories?${l.toString()}`,E=await fetch(f,{headers:{Accept:"application/json"}});if(!E.ok){n=!0;return}const d=await E.json(),w=Array.isArray(d==null?void 0:d.items)?d.items:[];if(w.length===0){n=!0;return}for(const c of w)c!=null&&c.html&&m.insertAdjacentHTML("beforeend",c.html);r=typeof(d==null?void 0:d.nextOffset)=="number"?d.nextOffset:r+w.length,m instanceof HTMLElement&&(m.dataset.nextOffset=String(r)),(d==null?void 0:d.hasMore)===!1&&(n=!0)}finally{a=!1,h(!1)}}},I=()=>R.getBoundingClientRect().top<=window.innerHeight+600,y=async()=>{for(;!a&&!n&&I();)await u()};new IntersectionObserver(l=>{const f=l[0];!f||!f.isIntersecting||y()},{rootMargin:"600px 0px"}).observe(R),y()}const A=document.getElementById("read-action"),z=document.getElementById("read-action-progress"),W=document.getElementById("read-action-icon-close"),j=document.getElementById("read-action-icon-up"),g=document.getElementById("top-stories-scroll"),H=document.getElementById("top-stories-prev"),B=document.getElementById("top-stories-next");if(g instanceof HTMLElement&&H instanceof HTMLButtonElement&&B instanceof HTMLButtonElement){let a=!1;const n=()=>g.scrollLeft+g.clientWidth>=g.scrollWidth-8,s=()=>g.scrollLeft<=8,e=()=>g.scrollWidth>g.clientWidth+8,t=()=>{const r=e();H.classList.toggle("hidden",s()),H.disabled=!r,H.classList.toggle("opacity-30",!r),H.classList.toggle("cursor-not-allowed",!r),B.disabled=!r,B.classList.toggle("opacity-30",!r),B.classList.toggle("cursor-not-allowed",!r)},o=()=>{a||(a=!0,window.requestAnimationFrame(()=>{t(),a=!1}))};B.addEventListener("click",()=>{if(!e())return;if(n()){g.scrollTo({left:0,behavior:"smooth"});return}const r=Math.max(220,Math.round(g.clientWidth*.7));g.scrollBy({left:r,behavior:"smooth"})}),H.addEventListener("click",()=>{if(!e())return;const r=Math.max(220,Math.round(g.clientWidth*.7));g.scrollBy({left:-r,behavior:"smooth"})}),g.addEventListener("scroll",o,{passive:!0}),window.addEventListener("resize",o),t()}if(A instanceof HTMLButtonElement&&z instanceof SVGPathElement){let a=!1,n=!1;const s=o=>{n=o,W instanceof SVGElement&&W.classList.toggle("hidden",o),j instanceof SVGElement&&j.classList.toggle("hidden",!o),A.setAttribute("aria-label",o?"Back to top":"Close")},e=()=>{const o=document.documentElement,r=window.scrollY||o.scrollTop||0,h=Math.max(1,o.scrollHeight-window.innerHeight),u=Math.max(0,Math.min(1,r/h));z.setAttribute("stroke-dasharray",`${u*100} 100`),s(r>160)},t=()=>{a||(a=!0,window.requestAnimationFrame(()=>{e(),a=!1}))};A.addEventListener("click",()=>{if(n){window.scrollTo({top:0,behavior:"smooth"});return}const o=A.dataset.homeUrl;if(typeof o=="string"&&o!==""){window.location.href=o;return}}),window.addEventListener("scroll",t,{passive:!0}),window.addEventListener("resize",t),e()}
